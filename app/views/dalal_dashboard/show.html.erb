<% content_for :page_wrapper do %>

        <div id="page-wrapper">
            <div class="container-fluid">
                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">
                            Dalal Street <small>Statistics Overview</small>
                        </h1>
                        <ol class="breadcrumb">
                            <li class="active">
                             <i class="fa fa-dashboard"></i> Dalal Street
                            </li>
                            <li class="active">
                             <i class="fa fa-dashboard"></i> Statistics
                            </li>
                        </ol>
                    </div>
                </div>
                <!-- /.row -->

                <%= render partial:"dalal_dashboard/partials/panel_dashboard_partial",locals: { stocks_list: @stocks_list }%>
               
                <!-- /.row -->
                <div class="row">

                  <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-money fa-fw"></i> Transactions Panel</h3>
                            </div>
                            <div class="panel-body">
                             <%= render partial:"dalal_dashboard/partials/show_partial",locals: { stocks: @stocks }%>  
                            </div>
                             
                            </div>
                        </div>
                    </div>
                 </div> <!-- row -->

                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-long-arrow-right fa-fw"></i> Company Panel</h3>
                            </div>
                            
                          <div class="row">
                           <div class="col-lg-8">

                            <div class="panel-body">
                              <div class="list-group">
                                  <label>Company</label>
                                  <div class="btn-group btn-input clearfix">
                                     <button type="button" class="btn btn-default dropdown-toggle form-control" data-toggle="dropdown">
                                       <span data-bind="label">Select One</span>&nbsp;<span class="caret"></span>
                                     </button>
                                     <ul id="company_panel" class="dropdown-menu" role="menu">
                                      <%@stocks.each do |stock|%>
                                      <li><a href="#company_panel" <%= "onclick=get_company_name('#{stock.stockname}');"%>><%= stock.stockname%></a></li> 
                                       <%end-%>
                                     </ul>
                                   </div>
                               </div>   
                             </div>  
                        
                                <div class="panel-body">
                                    <% if !@no_stock_found %>
                   <%= render partial:"dalal_dashboard/partials/company_partial",locals: { stock: @stock }%>
                                    <% else %>
                                            <div><%= "#{@no_stock_found}" %></div>
                                    <% end %>
                                </div>

                            <div class="panel-body">

                            <div role="tabpanel">
                              <ul id="myTab" class="nav nav-tabs" role="tablist">
                                <li role="presentation"  class="active"><a href="#cur_price" aria-controls="home" role="tab" data-toggle="tab">Current Price</a></li>
                                <li role="presentation"><a href="#mark_cap" aria-controls="profile" role="tab" data-toggle="tab">Market capital</a></li>
                              </ul>
                              <!-- Tab panes -->
                              <div class="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="cur_price"> 
                                    <div>
                                    <canvas id="canvas_line" width="401" height="150" style="width: 401px; height: 150px;"></canvas>
                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="mark_cap">
                                    <div>
                                    <canvas id="canvas_line2" width="401" height="150" style="width: 401px; height: 150px;"></canvas>
                                    </div>
                                </div>
                              </div>
                            </div>

                            </div>

                        </div><!-- col-->
                        <div class="col-lg-4">
                            <div class="panel-heading" style="background-color:#fff;color:#424242;">
                                <h3 class="panel-title"><i class="fa fa-long-arrow-right fa-fw"></i> Company Event</h3>
                            </div>
                            <div class="panel-body">
                                <div class="list-group" id="market_event_list" data-uri="<%= request.host %>:<%= request.port %>/websocket">
                                 <% if !@no_stock_found %>
                  <%= render partial:"dalal_dashboard/partials/marketevent_partial",locals: { market_event_list: @market_event_list }%> 
                                 <% end %>   
                                 </div>
                                  <a href="#marketevent_modal" data-toggle="modal" data-target="#marketevent_modal">View All Activity <i class="fa fa-arrow-circle-right"></i></a>
                            </div>
                        </div>  

                        </div> <!--row -->

                        </div><!--panel default-->
                    </div><!-- col -->
                </div><!-- /.row -->

                <div class="row">
                    <div class="col-lg-7">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-long-arrow-right fa-fw"></i> Mortaged Stocks</h3>
                            </div>
                                <div class="panel-body">
                                <div class="table-responsive">
                                 <% if !@no_mortgage_found %>
                                     <table class="table table-bordered table-hover table-striped" data-uri="<%= request.host %>:<%= request.port %>/websocket">
                                        <thead>
                                            <tr>
                                                <th>Stock</th>
                                                <th>DayLow</th>
                                                <th>DayHigh</th>
                                                <th>Current (USD)</th>
                                                <th>MortgagedPrice</th>
                                                <th>StockMortgaged</th>
                                            </tr>
                                        </thead>
                                        
                                        <tbody id="render_tbody_show">
                                             <% @mortgage.each do |stock| %>
                                                <tr>
                                                <% if stock.updown == 1%>
                                                    <% @color="style=color:green"%> 
                                                    <% @image="src=/assets/up-arrow.jpg"%> 
                                                <% else %> 
                                                    <% @color="style=color:red" %>
                                                    <% @image="src=/assets/stock_down.gif"%> 
                                                <%end%>
                                                    <td><%=stock.stockname %></td>
                                                    <td><%=stock.daylow.round(2) %></td>
                                                    <td><%=stock.dayhigh.round(2) %></td>
                                                    <td <%=@color%> ><%=stock.currentprice.round(2) %><span><img <%=@image%> style="width:7px;height:7px;"></img></span></td>
                                                    <td><%=stock.pricerendered.round(2) %></td>
                                                    <td><%=stock.numofstock %></td>
                                                </tr>
                                            <% end %>     
                                        </tbody>
                                    </table>
                                    <% else %>
                                      <div><%= "#{@no_mortgage_found}" %></div>
                                    <% end %>
                                    </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-5">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-clock-o fa-fw"></i> Notification Panel</h3>
                            </div>
                            <div class="panel-body">
                                <div class="list-group" id ="notification">
                                  <%= render partial:"dalal_dashboard/partials/notification_partial",locals: { notifications_list: @notifications_list }%> 
                                </div>
                                <div class="text-right">
                <a href="#notification_modal" data-toggle="modal" data-target="#notification_modal">View All Activity <i class="fa fa-arrow-circle-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.row -->

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->
<% end %>

<% content_for :style do %>

<% end %>

<% content_for :script do %>
 
 <%= render partial:"dalal_dashboard/partials/chart_partial.html.erb",locals: {price_list: @price_list}%>
 <%= render partial:"dalal_dashboard/partials/chart_partial_2.html.erb",locals: {price_list: @price_list}%>

 
 <script type="text/javascript">
 
              $(function(){
                    var show_channel = new WebsocketClass(".table");
                    var show_subscribe = show_channel.channel_subscribe("show");
                    var show_binder = show_channel.channel_binder("show_channel",get_userstock_info);
               });

               var get_userstock_info = function(data){
                    var data = {bool:true};
                    var show_update_socket = new WebsocketClass(".table");
                    var show_update_socket_binder = show_update_socket.evt_binder("index_updater");
                    var show_update_socket_trigger = show_update_socket.evt_trigger("index_updater",data);
                    var show_update_socket_unbind = show_update_socket.evt_unbinder();
               };

                var get_company_name = function(name){
                   get_company_info(name);
                };
                
                var get_company_info = function(company_name){
                    var data = {name: company_name};
                    var company_socket = new WebsocketClass("#market_event_list");
                    var company_socket_binder = company_socket.evt_binder("company_handler");
                    var company_socket_trigger = company_socket.evt_trigger("company_handler",data);
                    var company_socket_unbind = company_socket.evt_unbinder();
                };
  
                $("#myTab a").click(function(b) {
                  b.preventDefault();
                  $(this).tab("show") 
                });
</script>

<% end %>    
